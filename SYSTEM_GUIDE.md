# üöÄ –°–ò–°–¢–ï–ú–ê –ö–û–ù–¢–†–û–õ–Ø –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê - –†–£–ö–û–í–û–î–°–¢–í–û –î–õ–Ø –ê–°–°–ò–°–¢–ï–ù–¢–ê

> **–ö–†–ò–¢–ò–ß–ù–û**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π —ç—Ç–æ—Ç —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –∏ –æ–±–Ω–æ–≤–ª—è–π –µ–≥–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ!

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï
1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [Backend —Ñ—É–Ω–∫—Ü–∏–∏](#backend-—Ñ—É–Ω–∫—Ü–∏–∏)
4. [Frontend —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#frontend-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
5. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏)
6. [–ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π](#—á–µ–∫-–ª–∏—Å—Ç)

---

## üèóÔ∏è –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç:
- **–ó–∞–∫–∞–∑—á–∏–∫–∏ (clients)** —Å–æ–∑–¥–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã, —Ä–∞–±–æ—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–ü–æ–¥—Ä—è–¥—á–∏–∫–∏ (contractors)** –≤–µ–¥—É—Ç –∂—É—Ä–Ω–∞–ª—ã —Ä–∞–±–æ—Ç, –æ—Ç—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
- **–ê–¥–º–∏–Ω—ã** —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
```
Frontend:  React 18 + TypeScript + Vite + Tailwind CSS + shadcn/ui
           Redux Toolkit (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)
           Axios (HTTP –∫–ª–∏–µ–Ω—Ç —Å interceptors)
Backend:   Python 3.11 (Cloud Functions)
Database:  PostgreSQL (Simple Query Protocol ONLY!)
Auth:      JWT —Ç–æ–∫–µ–Ω—ã –≤ localStorage + Redux
Icons:     lucide-react —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Icon
```

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (—Å 2025-10-20)

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º: Redux Toolkit**
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π React.Context –¥–ª—è –¥–∞–Ω–Ω—ã—Ö (–∫—Ä–æ–º–µ AuthContext - –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏ –≤ Redux slices
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π createAsyncThunk –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π selectors –¥–ª—è –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**HTTP –∫–ª–∏–µ–Ω—Ç: Axios —á–µ—Ä–µ–∑ apiClient**
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π fetch() –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π apiClient –∏–∑ src/api/apiClient.ts
- ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ src/api/endpoints.ts
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ interceptor

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –°—Ö–µ–º–∞
`t_p8942561_contractor_control_s`

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ü–†–û–°–¢–û–ô –ü–†–û–¢–û–ö–û–õ –ó–ê–ü–†–û–°–û–í
**–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π Simple Query Protocol:**
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å `%s`, `$1`, –∏ —Ç.–¥.
- ‚úÖ –ü–æ–¥—Å—Ç–∞–≤–ª—è–π –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ SQL —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ü—Ä–∏–º–µ—Ä: `WHERE id = 123` –≤–º–µ—Å—Ç–æ `WHERE id = %s`

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–≤—è–∑–∏

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø
```
users (id, email, phone, password_hash, name, role, organization)
  ‚Üì
user_sessions (session_token, user_id, expires_at)
verification_codes (code, phone, expires_at)
```

#### –ò–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
```
objects (id, title, address, client_id, status)
  ‚Üì
works (id, object_id, title, contractor_id, status, start_date, end_date, completion_percentage)
  ‚Üì
work_logs (id, work_id, log_type, date, description, author_id)
inspections (id, work_id, inspection_number, status, scheduled_date, created_by)
```

#### –°–æ–±—ã—Ç–∏—è –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
```
inspection_events (id, inspection_id, event_type, created_by, metadata)
  - event_type: 'scheduled', 'started', 'completed', 'rescheduled'
  - metadata: jsonb —Å –¥–æ–ø. –¥–∞–Ω–Ω—ã–º–∏ (scheduled_date, defects_count, etc.)

chat_messages (id, work_id, sender_id, message, created_at)

info_posts (id, object_id, title, content, author_id, created_at)
```

#### –î–µ—Ñ–µ–∫—Ç—ã –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
```
defect_reports (id, inspection_id, title, defects jsonb[], created_by)
  ‚Üì
defect_remediations (id, report_id, defect_id, status, remediated_at)
```

#### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
```
work_templates (id, client_id, name, description, checkpoints jsonb[])
work_types (id, name, category, description)
client_contractors (client_id, contractor_id, status)
```

### –í–∞–∂–Ω—ã–µ –ø–æ–ª—è –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è

**works.status:**
- `active` - –≤ —Ä–∞–±–æ—Ç–µ
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- `delayed` - –∑–∞–¥–µ—Ä–∂–∫–∞

**inspections.status:**
- `draft` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞
- `active` - –Ω–∞—á–∞—Ç–∞
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**users.role:**
- `client` - –∑–∞–∫–∞–∑—á–∏–∫
- `contractor` - –ø–æ–¥—Ä—è–¥—á–∏–∫
- `admin` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

---

## üîß BACKEND –§–£–ù–ö–¶–ò–ò

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
`/backend/[function-name]/index.py`

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î –≤ backend
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - Simple Query
import psycopg
conn = psycopg.connect(dsn)
cursor = conn.cursor()
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - Extended Query (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!)
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `auth/` - –≤—Ö–æ–¥ –ø–æ email/–ø–∞—Ä–æ–ª—é
- `register/` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `send-verification-code/` - –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞
- `verify-code/` - –ø—Ä–æ–≤–µ—Ä–∫–∞ SMS –∫–æ–¥–∞ –∏ –≤—Ö–æ–¥

#### –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `user-data/` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–±—ä–µ–∫—Ç—ã, —Ä–∞–±–æ—Ç—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–æ–æ–±—â–µ–Ω–∏—è)
- `create-data/` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤/—Ä–∞–±–æ—Ç/–ø—Ä–æ–≤–µ—Ä–æ–∫/–∑–∞–ø–∏—Å–µ–π
- `update-data/` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `mark-seen/` - –ø–æ–º–µ—Ç–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ

#### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `get-feed/` - –ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è dashboard
- `inspection-event/` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `work-status/` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã
- `invite-contractor/` - –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞
- `link-contractor/` - –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ –∫ –∑–∞–∫–∞–∑—á–∏–∫—É
- `get-contractor-tasks/` - –∑–∞–¥–∞—á–∏ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞
- `defect-reports/` - —Ä–∞–±–æ—Ç–∞ —Å –æ—Ç—á–µ—Ç–∞–º–∏ –æ –¥–µ—Ñ–µ–∫—Ç–∞—Ö
- `defect-remediation/` - —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤

#### –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
- `admin/` - –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∞
- `admin-users/` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `work-types/` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞–º–∏ —Ä–∞–±–æ—Ç

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ backend
```python
return {
    'statusCode': 200,
    'headers': {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
    },
    'isBase64Encoded': False,
    'body': json.dumps({'data': result})
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ DATABASE_URL
```python
import os
DSN = os.environ.get('DATABASE_URL')
```

---

## üé® FRONTEND –°–¢–†–£–ö–¢–£–†–ê

### –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
```
src/main.tsx (Redux Provider) ‚Üí src/App.tsx ‚Üí src/components/Layout.tsx
```

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: Redux Toolkit Architecture

**Store —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```typescript
src/store/
‚îú‚îÄ‚îÄ store.ts              // configureStore —Å Redux DevTools
‚îú‚îÄ‚îÄ hooks.ts              // useAppDispatch, useAppSelector
‚îî‚îÄ‚îÄ slices/
    ‚îú‚îÄ‚îÄ userSlice.ts      // auth + userData
    ‚îú‚îÄ‚îÄ objectsSlice.ts   // CRUD –æ–±—ä–µ–∫—Ç–æ–≤
    ‚îú‚îÄ‚îÄ worksSlice.ts     // CRUD —Ä–∞–±–æ—Ç
    ‚îú‚îÄ‚îÄ workLogsSlice.ts  // –∂—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç
    ‚îú‚îÄ‚îÄ inspectionsSlice.ts  // –ø—Ä–æ–≤–µ—Ä–∫–∏
    ‚îî‚îÄ‚îÄ contractorsSlice.ts  // –ø–æ–¥—Ä—è–¥—á–∏–∫–∏
```

**API Client:**
```typescript
src/api/
‚îú‚îÄ‚îÄ apiClient.ts          // Axios instance —Å interceptors
‚îî‚îÄ‚îÄ endpoints.ts          // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—Å–µ—Ö URL
```

**–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å Redux:**

1. **–î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º:**
```typescript
// ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π Context
const { user } = useAuth(); // —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Redux
import { useAppSelector } from '@/store/hooks';
const user = useAppSelector((state) => state.user.user);
```

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// ‚ùå –ù–ï –≤—ã–∑—ã–≤–∞–π API –Ω–∞–ø—Ä—è–º—É—é
await fetch('/api/objects', { method: 'POST', body: ... });

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Redux thunks
import { useAppDispatch } from '@/store/hooks';
import { createObject } from '@/store/slices/objectsSlice';

const dispatch = useAppDispatch();
await dispatch(createObject({ title: '–ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç', ... }));
```

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤:**
```typescript
// ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π userData.objects
const objects = userData?.objects || [];

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π slice –Ω–∞–ø—Ä—è–º—É—é
const objects = useAppSelector((state) => state.objects.items);
```

4. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:**
```typescript
// –î–ª—è –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π selectors
// src/store/slices/objectsSlice.ts
export const selectActiveObjects = (state: RootState) => 
  state.objects.items.filter(obj => obj.status === 'active');

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const activeObjects = useAppSelector(selectActiveObjects);
```

5. **Loading —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```typescript
// –ö–∞–∂–¥—ã–π slice –∏–º–µ–µ—Ç loading/error
const { loading, error } = useAppSelector((state) => state.objects);

if (loading) return <Skeleton />;
if (error) return <ErrorMessage text={error} />;
```

**API Client –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
// ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π fetch
const response = await fetch('/api/objects');

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π apiClient
import { apiClient } from '@/api/apiClient';
import { ENDPOINTS } from '@/api/endpoints';

const response = await apiClient.get(ENDPOINTS.USER.DATA);
// –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ thunk:
const response = await apiClient.post(ENDPOINTS.ENTITIES.CREATE, { 
  type: 'object', 
  data: { title: '–ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç' }
});
```

**Interceptors —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –î–æ–±–∞–≤–ª—è—é—Ç X-Auth-Token –∏–∑ localStorage
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –Ω–∞ /login –ø—Ä–∏ 401/403
- –ù–æ—Ä–º–∞–ª–∏–∑—É—é—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç { success, data, error, code }

### –†–æ—É—Ç–∏–Ω–≥ (src/App.tsx)
```
/login, /register - –ø—É–±–ª–∏—á–Ω—ã–µ
/dashboard - –≥–ª–∞–≤–Ω–∞—è (–ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π)
/objects - —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
/objects/:objectId - –¥–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞
/objects/:objectId/works/:workId - –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã
/inspection/:inspectionId - –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
/defect-report/:reportId - –æ—Ç—á–µ—Ç –æ –¥–µ—Ñ–µ–∫—Ç–∞—Ö
/my-works - —Ä–∞–±–æ—Ç—ã –ø–æ–¥—Ä—è–¥—á–∏–∫–∞
/contractors - –ø–æ–¥—Ä—è–¥—á–∏–∫–∏
/analytics - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
/admin - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (src/contexts/AuthContext.tsx)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**
```typescript
user: User | null           // —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
token: string | null        // JWT —Ç–æ–∫–µ–Ω
userData: UserData | null   // –∫—ç—à –¥–∞–Ω–Ω—ã—Ö (objects, works, inspections, etc.)
isAuthenticated: boolean
isLoading: boolean
```

**–ú–µ—Ç–æ–¥—ã:**
```typescript
login(email, password)           // –≤—Ö–æ–¥ –ø–æ email
loginWithPhone(phone, code)      // –≤—Ö–æ–¥ –ø–æ SMS
register(data)                   // —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
logout()                         // –≤—ã—Ö–æ–¥
loadUserData()                   // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å backend
setUserData(data)                // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞
```

**API endpoints:**
```typescript
AUTH_API = 'https://functions.poehali.dev/b9d6731e-788e-476b-bad5-047bd3d6adc1'
USER_DATA_API = 'https://functions.poehali.dev/bdee636b-a6c0-42d0-8f77-23c316751e34'
VERIFY_CODE_API = 'https://functions.poehali.dev/09b6a02f-8537-4a53-875d-3a46d3fdc278'
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
src/components/
‚îú‚îÄ‚îÄ ui/                          # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ icon.tsx                 # ‚ö†Ô∏è –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∏–∫–æ–Ω–æ–∫!
‚îÇ   ‚îú‚îÄ‚îÄ button.tsx, input.tsx, dialog.tsx, etc.
‚îÇ
‚îú‚îÄ‚îÄ layout/                      # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ TopNavigation.tsx        # –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é (desktop)
‚îÇ   ‚îú‚îÄ‚îÄ BottomNavigation.tsx     # –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é (mobile)
‚îÇ
‚îú‚îÄ‚îÄ dashboard/                   # Dashboard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ FeedEventCard.tsx        # –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–±—ã—Ç–∏—è –≤ –ª–µ–Ω—Ç–µ
‚îÇ   ‚îú‚îÄ‚îÄ CreateActionButton.tsx   # –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ objects/                     # –û–±—ä–µ–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ ObjectsGridView.tsx      # –°–µ—Ç–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ObjectsTableView.tsx     # –¢–∞–±–ª–∏—Ü–∞ –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ work-journal/                # –ñ—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ WorksList.tsx            # –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ JournalTabContent.tsx    # –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ –∂—É—Ä–Ω–∞–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ CreateInspectionSimple.tsx
‚îÇ
‚îú‚îÄ‚îÄ inspection/                  # –ü—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ InspectionHeader.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DefectsSection.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ControlPointsSection.tsx
‚îÇ
‚îú‚îÄ‚îÄ defect-report/               # –û—Ç—á–µ—Ç—ã –æ –¥–µ—Ñ–µ–∫—Ç–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ DefectReportHeader.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DefectItem.tsx
‚îÇ
‚îú‚îÄ‚îÄ admin/                       # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ UsersTable.tsx
‚îÇ   ‚îú‚îÄ‚îÄ AdminWorkTypes.tsx
```

### –°—Ç—Ä–∞–Ω–∏—Ü—ã (src/pages/)

```
Dashboard.tsx         - –ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π (–≥–ª–∞–≤–Ω–∞—è)
Objects.tsx           - —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
ObjectDetail.tsx      - –¥–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞ + —Ä–∞–±–æ—Ç—ã
WorkDetail.tsx        - –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã + –∂—É—Ä–Ω–∞–ª
InspectionDetail.tsx  - –ø—Ä–æ–≤–µ—Ä–∫–∞ + –¥–µ—Ñ–µ–∫—Ç—ã
MyWorks.tsx           - —Ä–∞–±–æ—Ç—ã –ø–æ–¥—Ä—è–¥—á–∏–∫–∞
Contractors.tsx       - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞–º–∏
Analytics.tsx         - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
Admin.tsx             - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
```

### –£—Ç–∏–ª–∏—Ç—ã (src/utils/)

```
dateValidation.ts        # ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç (isValidDate, safeFormatDate, safeDateCompare)
```

### –¢–∏–ø—ã (src/types/)

–û–±—â–∏–µ TypeScript —Ç–∏–ø—ã –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## ‚ö†Ô∏è –¢–ò–ü–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò –ò –ö–ê–ö –ò–• –ò–ó–ë–ï–ñ–ê–¢–¨

### 1. –û—à–∏–±–∫–∏ —Å –¥–∞—Ç–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1212-12-12) –ª–æ–º–∞—é—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π —É—Ç–∏–ª–∏—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
import { isValidDate, safeFormatDate, safeDateCompare } from '@/utils/dateValidation';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã
if (!isValidDate(dateString)) {
  return ''; // –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
}

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
const formatted = safeFormatDate(dateString);

// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
items.sort((a, b) => safeDateCompare(a.date, b.date));
```

### 2. –û—à–∏–±–∫–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–∫–æ–Ω–æ–∫ –∏–∑ lucide-react –ø–∞–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚ùå –ù–ï –¥–µ–ª–∞–π —Ç–∞–∫:
import { SomeIcon } from 'lucide-react';

// ‚úÖ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Icon:
import Icon from '@/components/ui/icon';
<Icon name="Home" size={24} fallback="CircleAlert" />
```

### 3. –û—à–∏–±–∫–∏ —Å –ë–î –≤ backend

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```python
# ‚ùå –ù–ï –¥–µ–ª–∞–π —Ç–∞–∫:
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))

# ‚úÖ –î–µ–ª–∞–π —Ç–∞–∫:
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")

# ‚úÖ –ò–ª–∏ —Ç–∞–∫ (—Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º):
from psycopg import sql
query = sql.SQL("SELECT * FROM users WHERE email = {email}").format(
    email=sql.Literal(email)
)
cursor.execute(query)
```

### 4. –û—à–∏–±–∫–∏ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º userData

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö UI –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—ã–∑—ã–≤–∞–π loadUserData()
const { loadUserData } = useAuth();

const handleCreate = async () => {
  await createData(...);
  await loadUserData(); // –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
};
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–±—ã–ª –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ –∑–∞–ø—Ä–æ—Å

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
const response = await fetch(API_URL, {
  headers: {
    'Content-Type': 'application/json',
    'X-User-Token': token // –ù–ï Authorization! (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º)
  }
});
```

### 6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `.filter()` –∏–ª–∏ `.sort()` –ø–∞–¥–∞–µ—Ç –Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π filterValidDates
import { filterValidDates } from '@/utils/dateValidation';
const validItems = filterValidDates(items, 'scheduled_date');
```

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ –ü–ï–†–ï–î –†–ê–ë–û–¢–û–ô

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ë–î:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ `get_db_info`
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é —Ç–æ–ª—å–∫–æ Simple Query Protocol
- [ ] –ù–∞–ø–∏—Å–∞–ª –º–∏–≥—Ä–∞—Ü–∏—é –≤ `db_migrations/`
- [ ] –í—ã–∑–≤–∞–ª `migrate_db` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º backend:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ `/backend/`
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é Simple Query –¥–ª—è –ë–î
- [ ] –î–æ–±–∞–≤–∏–ª CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é OPTIONS –∑–∞–ø—Ä–æ—Å
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (statusCode, headers, body, isBase64Encoded)
- [ ] –í—ã–∑–æ–≤—É `sync_backend` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º frontend:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª `AuthContext` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é `Icon` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∏–∫–æ–Ω–æ–∫
- [ ] –í–∞–ª–∏–¥–∏—Ä—É—é –¥–∞—Ç—ã —á–µ—Ä–µ–∑ `dateValidation.ts`
- [ ] –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–∑—ã–≤–∞—é `loadUserData()`
- [ ] –î–æ–±–∞–≤–∏–ª —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Token`

### –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ª–æ–≥–∏ frontend: `get_logs source=frontend`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ª–æ–≥–∏ backend: `get_logs source=backend/[function-name]`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –¥–∞–Ω–Ω—ã–µ –≤ –ë–î: `perform_sql_query`

---

## üéØ –ë–´–°–¢–†–´–ï –°–°–´–õ–ö–ò

**–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
get_db_info(level="schema", schema_name="t_p8942561_contractor_control_s")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
perform_sql_query("SELECT * FROM users LIMIT 10")

# –õ–æ–≥–∏ frontend
get_logs(source="frontend", limit=100)

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
get_logs(source="backend/user-data", limit=50)
```

**–ß–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `src/contexts/AuthContext.tsx` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∫—ç—à
- `src/App.tsx` - —Ä–æ—É—Ç–∏–Ω–≥
- `src/components/Layout.tsx` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- `backend/user-data/index.py` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `backend/create-data/index.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

---

## üîÑ –ö–õ–Æ–ß–ï–í–´–ï –ë–ò–ó–ù–ï–°-–ü–†–û–¶–ï–°–°–´

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Inspection)

**–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞:**
- Dashboard ‚Üí CreateInspectionWithWorkSelect
- WorkJournal ‚Üí CreateInspectionSimple
- ObjectDetail ‚Üí CreateInspectionSimple

**–°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–±–æ—Ç—É (work_id)
2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É (scheduled_date)
3. Frontend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç:
   - –î–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –≥–æ–¥—É (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
   - –†–∞–±–æ—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
4. Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
   api.createItem(token, 'inspection', {
     work_id,
     type: scheduledDate ? 'scheduled' : 'unscheduled',
     title: '–ü—Ä–æ–≤–µ—Ä–∫–∞',
     scheduled_date,
     status: scheduledDate ? 'draft' : 'active'
   })
5. Backend (create-data/index.py):
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ inspections
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç inspection_number (INS-{work_id}-{counter})
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç inspection_event:
     * event_type: 'scheduled' (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç–∞) –∏–ª–∏ 'started'
     * metadata: {scheduled_date} (–µ—Å–ª–∏ –µ—Å—Ç—å)
6. Frontend:
   - –ü–æ–ª—É—á–∞–µ—Ç inspection_id –∏–∑ –æ—Ç–≤–µ—Ç–∞
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ /inspection/{id}
   - –í—ã–∑—ã–≤–∞–µ—Ç loadUserData() –≤ —Ñ–æ–Ω–µ
```

**–í–∞–∂–Ω—ã–µ –ø–æ–ª—è inspections:**
```sql
id                  - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
work_id             - —Å–≤—è–∑—å —Å —Ä–∞–±–æ—Ç–æ–π (FK)
inspection_number   - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä (INS-25-1)
created_by          - –∫—Ç–æ —Å–æ–∑–¥–∞–ª (user_id)
status              - draft | active | completed
type                - scheduled | unscheduled
scheduled_date      - –¥–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ type=scheduled)
title               - –æ–±—ã—á–Ω–æ "–ü—Ä–æ–≤–µ—Ä–∫–∞"
defects             - JSON –º–∞—Å—Å–∏–≤ –¥–µ—Ñ–µ–∫—Ç–æ–≤
photo_urls          - —Å—Ç—Ä–æ–∫–∞ —Å URL —Ñ–æ—Ç–æ
created_at          - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
completed_at        - –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
```

**–í–∞–∂–Ω—ã–µ –ø–æ–ª—è inspection_events:**
```sql
id              - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
inspection_id   - —Å–≤—è–∑—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π (FK)
event_type      - scheduled | started | completed | rescheduled
created_by      - –∫—Ç–æ —Å–æ–∑–¥–∞–ª —Å–æ–±—ã—Ç–∏–µ
metadata        - JSONB —Å –¥–æ–ø. –¥–∞–Ω–Ω—ã–º–∏:
                  {"scheduled_date": "2025-10-20"}
                  {"defects_count": 2}
created_at      - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

**–°–≤—è–∑—å inspections ‚Üî inspection_events:**
- 1 –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –º–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏–π (1:N)
- –°–æ–±—ã—Ç–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ backend –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò —Å–æ–∑–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª–µ —Ä–∞–±–æ—Ç (Work Log)

**–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞:**
- Dashboard ‚Üí JournalEntryModal
- WorkJournal ‚Üí JournalTabContent
- ObjectDetail ‚Üí WorkDetailJournal

**–°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É:
   - –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç (description)
   - –û–±—ä–µ–º (volume) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (materials) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - –§–æ—Ç–æ (photo_urls) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (progress) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
2. Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
   api.createItem(token, 'work_log', {
     work_id,
     description,
     volume,
     materials,
     photo_urls: JSON.stringify(urls),
     progress,
     is_work_start: false (–∏–ª–∏ true –¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏)
   })
3. Backend (create-data/index.py):
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ work_logs
   - –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ —Ä–∞–±–æ—Ç–µ (work_id)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç created_by = user_id –∏–∑ —Ç–æ–∫–µ–Ω–∞
4. Frontend:
   - –í—ã–∑—ã–≤–∞–µ—Ç loadUserData() –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–µ–Ω—Ç—É —Å–æ–±—ã—Ç–∏–π
```

**–í–∞–∂–Ω—ã–µ –ø–æ–ª—è work_logs:**
```sql
id                      - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
work_id                 - —Å–≤—è–∑—å —Å —Ä–∞–±–æ—Ç–æ–π (FK)
description             - –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç
volume                  - –æ–±—ä–µ–º
materials               - –º–∞—Ç–µ—Ä–∏–∞–ª—ã
photo_urls              - —Å—Ç—Ä–æ–∫–∞ —Å URL (JSON.stringify)
created_by              - –∫—Ç–æ —Å–æ–∑–¥–∞–ª (user_id)
created_at              - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
is_work_start           - boolean (–ø–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å = –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç)
completion_percentage   - –ø—Ä–æ–≥—Ä–µ—Å—Å (0-100)
is_inspection_start     - —Å–≤—è–∑–∞–Ω–æ —Å –Ω–∞—á–∞–ª–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
is_inspection_completed - —Å–≤—è–∑–∞–Ω–æ —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
inspection_id           - —Å–≤—è–∑—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
defects_count           - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**–°–≤—è–∑—å work_logs ‚Üî inspections:**
- work_log –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —á–µ—Ä–µ–∑ inspection_id
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ —Å:
  * is_inspection_completed = true
  * defects_count = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤
  * inspection_id = ID –ø—Ä–æ–≤–µ—Ä–∫–∏

---

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (loadUserData)

**–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–∏ –≤—Ö–æ–¥–µ (AuthContext ‚Üí useEffect)
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞:**
```
1. Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
   const response = await fetch(USER_DATA_API, {
     headers: { 'X-Auth-Token': token }
   })
2. Backend (user-data/index.py):
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω (JWT)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç user_id –∏ role
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –ë–û–õ–¨–®–û–ô JOIN-–∑–∞–ø—Ä–æ—Å:
     * objects (—Å owner/client_id = user_id)
     * works (—á–µ—Ä–µ–∑ objects –∏–ª–∏ contractor_id)
     * inspections (—á–µ—Ä–µ–∑ works)
     * work_logs (—á–µ—Ä–µ–∑ works)
     * contractors (—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å user)
     * chat_messages (–ø–æ work_id)
     * unreadCounts (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö)
3. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
   {
     objects: [...],
     works: [...],
     inspections: [...],
     workLogs: [...],
     contractors: [...],
     chatMessages: [...],
     unreadCounts: {work_id: {logs: N, messages: M, inspections: K}}
   }
4. Frontend:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ AuthContext.userData
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
await api.createItem(...);
// UI –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è!

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
await api.createItem(...);
await loadUserData(); // –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
```

---

### 4. –õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π (Feed)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** Dashboard.tsx

**–°—Ö–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏:**
```
1. Frontend –≤—ã–∑—ã–≤–∞–µ—Ç:
   GET https://functions.poehali.dev/f38edb91-216d-4887-b091-ef224db01905?user_id={id}
2. Backend (get-feed/index.py):
   - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑:
     * work_logs ‚Üí —Ç–∏–ø 'work_log'
     * inspections + inspection_events ‚Üí —Ç–∏–ø—ã 'inspection_*'
     * info_posts ‚Üí —Ç–∏–ø 'info_post'
   - –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ created_at DESC
   - –û–±–æ–≥–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–º–∏:
     * author_name (–∏–∑ users)
     * work_title, object_title
     * metadata —Å–æ–±—ã—Ç–∏–π
3. Frontend:
   - –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç photoUrls (parse JSON –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞)
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Ç–∏–ø—É –∏ —Ç–µ–≥–∞–º
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç FeedEventCard –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
```

**–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –≤ –ª–µ–Ω—Ç–µ:**
```typescript
type: 'work_log'                 // –ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ
type: 'inspection'               // –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
type: 'inspection_scheduled'     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞
type: 'inspection_started'       // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∞—Ç–∞
type: 'inspection_completed'     // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
type: 'info_post'                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Å—Ç
```

---

### 5. –†–∞–±–æ—Ç–∞ —Å –¥–µ—Ñ–µ–∫—Ç–∞–º–∏ (Defects)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
inspections.defects (TEXT, JSON –º–∞—Å—Å–∏–≤):
[
  {
    "id": "1760623344037",          // timestamp
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
    "location": "2 —ç—Ç–∞–∂",
    "severity": "high",             // low | medium | high | critical
    "responsible": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
    "deadline": "2025-10-20"
  },
  ...
]
```

**–°—Ö–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–∞:**
```
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ InspectionDetail –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É
2. Frontend:
   - –ü–∞—Ä—Å–∏—Ç —Ç–µ–∫—É—â–∏–µ defects: JSON.parse(inspection.defects || '[]')
   - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –¥–µ—Ñ–µ–∫—Ç —Å id = Date.now()
   - –í—ã–∑—ã–≤–∞–µ—Ç api.updateItem(token, 'inspection', id, {
       defects: JSON.stringify(updatedDefects)
     })
3. Backend (update-data/index.py):
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ defects –≤ inspections
4. Frontend:
   - loadUserData() –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
```

**–û—Ç—á–µ—Ç—ã –æ –¥–µ—Ñ–µ–∫—Ç–∞—Ö (defect_reports):**
```sql
id              - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
inspection_id   - —Å–≤—è–∑—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π (FK)
title           - –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
defects         - JSONB –º–∞—Å—Å–∏–≤ –¥–µ—Ñ–µ–∫—Ç–æ–≤ (–∫–æ–ø–∏—è –∏–∑ inspections)
created_by      - –∫—Ç–æ —Å–æ–∑–¥–∞–ª
created_at      - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
```

**–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤ (defect_remediations):**
```sql
id              - –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
report_id       - —Å–≤—è–∑—å —Å –æ—Ç—á–µ—Ç–æ–º (FK)
defect_id       - ID –¥–µ—Ñ–µ–∫—Ç–∞ –∏–∑ JSON
status          - pending | in_progress | completed
remediated_at   - –∫–æ–≥–¥–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω
remediated_by   - –∫—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏–ª
```

---

## üó∫Ô∏è –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –†–û–£–¢–ò–ù–ì

### –ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

```
/login, /register (–ø—É–±–ª–∏—á–Ω—ã–µ)
  ‚Üì –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
/dashboard (–ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π)
  ‚îú‚îÄ‚Üí FeedEventCard (–∫–ª–∏–∫) ‚Üí /objects/{objectId} (state: scrollToWork)
  ‚îú‚îÄ‚Üí CreateActionButton ‚Üí –ú–æ–¥–∞–ª–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è
  ‚îî‚îÄ‚Üí NotificationsSummary ‚Üí /messages

/objects (—Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤)
  ‚îú‚îÄ‚Üí ObjectCard (–∫–ª–∏–∫) ‚Üí /objects/{objectId}
  ‚îî‚îÄ‚Üí –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç ‚Üí /objects/create

/objects/{objectId} (–¥–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞)
  ‚îú‚îÄ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Üí /objects/{objectId}/edit
  ‚îú‚îÄ‚Üí Work –≤ —Å–ø–∏—Å–∫–µ (–∫–ª–∏–∫) ‚Üí /objects/{objectId}/works/{workId}
  ‚îú‚îÄ‚Üí –°–æ–∑–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚Üí /objects/{objectId}/works/create
  ‚îî‚îÄ‚Üí –í–∫–ª–∞–¥–∫–∏: –†–∞–±–æ—Ç—ã, –ì—Ä–∞—Ñ–∏–∫, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

/objects/{objectId}/works/{workId} (–¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã)
  ‚îú‚îÄ‚Üí –í–∫–ª–∞–¥–∫–∏: –ñ—É—Ä–Ω–∞–ª, –û–ø–∏—Å–∞–Ω–∏–µ, –°–º–µ—Ç–∞, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  ‚îú‚îÄ‚Üí –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ‚Üí –º–æ–¥–∞–ª–∫–∞ ‚Üí /inspection/{id}
  ‚îú‚îÄ‚Üí –ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ (–∫–ª–∏–∫) ‚Üí /journal-entry/{id}
  ‚îî‚îÄ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–ø–∏—Å–∫–µ (–∫–ª–∏–∫) ‚Üí /inspection/{id}

/inspection/{inspectionId} (–¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏)
  ‚îú‚îÄ‚Üí –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é (—á–µ—Ä–µ–∑ sessionStorage)
  ‚îú‚îÄ‚Üí –ù–∞—á–∞—Ç—å/–ó–∞–≤–µ—Ä—à–∏—Ç—å ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ + —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
  ‚îú‚îÄ‚Üí –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ inspections.defects
  ‚îî‚îÄ‚Üí –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç ‚Üí /defect-report/{id}

/defect-report/{reportId} (–æ—Ç—á–µ—Ç –æ –¥–µ—Ñ–µ–∫—Ç–∞—Ö)
  ‚îú‚îÄ‚Üí –°–ø–∏—Å–æ–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –∏–∑ report.defects
  ‚îî‚îÄ‚Üí –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ defect_remediations

/my-works (—Ä–∞–±–æ—Ç—ã –ø–æ–¥—Ä—è–¥—á–∏–∫–∞)
  ‚îî‚îÄ‚Üí Work (–∫–ª–∏–∫) ‚Üí /objects/{objectId}/works/{workId}

/contractors (–ø–æ–¥—Ä—è–¥—á–∏–∫–∏)
  ‚îú‚îÄ‚Üí –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å ‚Üí –º–æ–¥–∞–ª–∫–∞
  ‚îî‚îÄ‚Üí –ü–æ–¥—Ä—è–¥—á–∏–∫ (–∫–ª–∏–∫) ‚Üí –º–æ–¥–∞–ª–∫–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏

/analytics (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
  ‚îî‚îÄ‚Üí –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º/—Ä–∞–±–æ—Ç–∞–º/–¥–µ—Ñ–µ–∫—Ç–∞–º

/admin (–∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å)
  ‚îú‚îÄ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  ‚îú‚îÄ‚Üí –¢–∏–ø—ã —Ä–∞–±–æ—Ç ‚Üí —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
  ‚îî‚îÄ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

### –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

**State –≤ navigate:**
```typescript
// –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ —Å–ø–∏—Å–∫–µ
navigate(`/objects/${objectId}`, {
  state: { scrollToWork: workId }
});

// –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
sessionStorage.setItem('inspectionFromPage', window.location.pathname);
navigate(`/inspection/${id}`);
// –ü–æ—Ç–æ–º:
const from = sessionStorage.getItem('inspectionFromPage');
if (from) navigate(from);
```

---

## üìä –ß–ê–°–¢–û –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –ó–ê–ü–†–û–°–´

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å —Å–æ–±—ã—Ç–∏—è–º–∏
```sql
SELECT 
  i.*,
  u.name as author_name,
  u.role as author_role,
  (
    SELECT json_agg(json_build_object(
      'id', ie.id,
      'event_type', ie.event_type,
      'created_at', ie.created_at,
      'metadata', ie.metadata
    ) ORDER BY ie.created_at)
    FROM inspection_events ie
    WHERE ie.inspection_id = i.id
  ) as events
FROM inspections i
LEFT JOIN users u ON i.created_by = u.id
WHERE i.work_id = {work_id}
ORDER BY i.created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å –∂—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç —Å –∞–≤—Ç–æ—Ä–∞–º–∏
```sql
SELECT 
  wl.*,
  u.name as author_name,
  u.role as author_role
FROM work_logs wl
LEFT JOIN users u ON wl.created_by = u.id
WHERE wl.work_id = {work_id}
ORDER BY wl.created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–∞–±–æ—Ç
```sql
SELECT 
  o.*,
  COUNT(w.id) as works_count,
  SUM(CASE WHEN w.status = 'active' THEN 1 ELSE 0 END) as active_works
FROM objects o
LEFT JOIN works w ON w.object_id = o.id
WHERE o.client_id = {user_id}
GROUP BY o.id
ORDER BY o.created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ
```sql
SELECT 
  w.id as work_id,
  COUNT(DISTINCT wl.id) FILTER (WHERE wl.created_at > v.last_seen_logs) as unread_logs,
  COUNT(DISTINCT cm.id) FILTER (WHERE cm.created_at > v.last_seen_messages) as unread_messages,
  COUNT(DISTINCT i.id) FILTER (WHERE i.created_at > v.last_seen_inspections) as unread_inspections
FROM works w
LEFT JOIN work_views v ON v.work_id = w.id AND v.user_id = {user_id}
LEFT JOIN work_logs wl ON wl.work_id = w.id
LEFT JOIN chat_messages cm ON cm.work_id = w.id
LEFT JOIN inspections i ON i.work_id = w.id
WHERE w.object_id IN (SELECT id FROM objects WHERE client_id = {user_id})
GROUP BY w.id, v.last_seen_logs, v.last_seen_messages, v.last_seen_inspections;
```

---

## üéØ –ü–ê–¢–¢–ï–†–ù–´ –ö–û–î–ê

### –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ API
```typescript
// –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω:
const handleCreate = async () => {
  if (!token || !user?.id) return;
  
  setLoading(true);
  try {
    const result = await api.createItem(token, 'type', {
      // –¥–∞–Ω–Ω—ã–µ
    });
    
    const itemId = result?.data?.id;
    if (!itemId) throw new Error('No ID returned');
    
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–∞–≤–∏–≥–∞—Ü–∏—è
    navigate(`/path/${itemId}`);
    
    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    await loadUserData();
    
    toast({ title: '–£—Å–ø–µ—Ö', description: '–°–æ–∑–¥–∞–Ω–æ' });
  } catch (error) {
    toast({ 
      title: '–û—à–∏–±–∫–∞', 
      description: '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å',
      variant: 'destructive'
    });
  } finally {
    setLoading(false);
  }
};
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
```typescript
import { isValidDate, safeFormatDate, safeDateCompare } from '@/utils/dateValidation';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã
if (!isValidDate(inspection.scheduled_date)) {
  return <span className="text-red-500">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞</span>;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
const formatted = safeFormatDate(inspection.scheduled_date, {
  day: 'numeric',
  month: 'long',
  year: 'numeric'
});

// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
inspections.sort((a, b) => safeDateCompare(a.scheduled_date, b.scheduled_date));

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
const validInspections = filterValidDates(inspections, 'scheduled_date');
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–æ–∫
```typescript
import Icon from '@/components/ui/icon';

// –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
<Icon name="Home" size={24} />

// –° fallback –Ω–∞ —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–∫–æ–Ω–∫–∏
<Icon name="CustomIcon" fallback="CircleAlert" size={20} />

// –í –∫–Ω–æ–ø–∫–∞—Ö
<Button>
  <Icon name="Plus" size={16} className="mr-2" />
  –°–æ–∑–¥–∞—Ç—å
</Button>
```

### –†–∞–±–æ—Ç–∞ —Å userData –∏–∑ AuthContext
```typescript
const { userData, loadUserData } = useAuth();

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
const objects = userData?.objects || [];
const works = userData?.works || [];

// –ü–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const work = works.find(w => w.id === workId);
const object = objects.find(o => o.id === work?.object_id);

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
const activeWorks = works.filter(w => w.status === 'active');
const objectWorks = works.filter(w => w.object_id === objectId);
```

---

## üêõ –û–¢–õ–ê–î–ö–ê: –° –ß–ï–ì–û –ù–ê–ß–ê–¢–¨

### –ü—Ä–æ–±–ª–µ–º–∞: "–î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è"

**–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±—Ä–∞—É–∑–µ—Ä–∞**
```typescript
get_logs(source="frontend", limit=100)
```
–ò—â–∏:
- –û—à–∏–±–∫–∏ —Å–µ—Ç–∏ (Failed to fetch)
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (isValidDate)
- –û—à–∏–±–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –≤ AuthContext**
```typescript
// –í –∫–æ–¥–µ Dashboard/Objects/etc –ø–æ—Å–º–æ—Ç—Ä–∏:
console.log('userData:', userData);
console.log('objects:', userData?.objects);
console.log('works:', userData?.works);
```

**–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î**
```sql
perform_sql_query("SELECT * FROM objects WHERE client_id = {user_id}")
perform_sql_query("SELECT * FROM works WHERE object_id = {object_id}")
```

**–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å backend –ª–æ–≥–∏**
```typescript
get_logs(source="backend/user-data", limit=50)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–°–æ–∑–¥–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –ø–æ—è–≤–∏–ª—Å—è"

**–ü—Ä–æ–≤–µ—Ä—å:**
1. `loadUserData()` –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è?
2. `result?.data?.id` –µ—Å—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ backend?
3. Backend –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–π INSERT?
4. –í –ë–î –ø–æ—è–≤–∏–ª–∞—Å—å –∑–∞–ø–∏—Å—å?

```typescript
// –¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞:
await api.createItem(...);
navigate('/objects'); // ‚ùå userData –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω!

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
await api.createItem(...);
await loadUserData(); // ‚úÖ –æ–±–Ω–æ–≤–∏–ª–∏ –∫—ç—à
navigate('/objects');
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –¥–∞—Ç"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –≤ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1212-12-12)

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// 1. –ù–∞–π–¥–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏:
perform_sql_query(`
  SELECT id, scheduled_date 
  FROM inspections 
  WHERE scheduled_date < '1900-01-01' OR scheduled_date > '2100-12-31'
`)

// 2. –ò—Å–ø—Ä–∞–≤—å –≤ –ë–î —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é
// 3. –ò—Å–ø–æ–ª—å–∑—É–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –≤ –∫–æ–¥–µ:
import { safeDateCompare, filterValidDates } from '@/utils/dateValidation';
```

---

## üìù –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö –ü–ï–†–ï–î –ö–û–ú–ú–ò–¢–û–ú

### Backend —Ñ—É–Ω–∫—Ü–∏—è
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Simple Query Protocol (–±–µ–∑ %s)
- [ ] –ï—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ OPTIONS –¥–ª—è CORS
- [ ] –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∫–ª—é—á–∞—é—Ç Access-Control-Allow-Origin: *
- [ ] –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: {statusCode, headers, body, isBase64Encoded}
- [ ] –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ X-Auth-Token (–Ω–µ Authorization!)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å print()
- [ ] –í—ã–∑–≤–∞–Ω sync_backend –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Icon –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∏–∫–æ–Ω–æ–∫
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç —á–µ—Ä–µ–∑ dateValidation.ts
- [ ] –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è loadUserData()
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: userData?.objects || []
- [ ] Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
- [ ] Loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é (migrate_db)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ get_db_info
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ perform_sql_query
- [ ] Simple Query Protocol (–±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-20  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π